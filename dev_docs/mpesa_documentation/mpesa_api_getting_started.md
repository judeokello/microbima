# Getting Started

Learn how to set up and integrate Daraja APIs into your application and start accepting M-Pesa payments today.

## Introduction

Welcome to Safaricom APIs. Safaricom is committed to innovation and helping our partners grow. This release provides API endpoints for B2C, C2B, and B2B M-Pesa services.

The APIs are RESTful, using HTTP verbs (GET and POST) with JSON-encoded request parameters and responses. They comply with HTTP status codes as defined in RFC 2616.

You can use REST clients like Postman or SoapUI, or command-line tools like Curl and Node.js. Code samples are available in Curl, Ruby, PHP, Python, NodeJS, and Java, along with sample JSON responses.

## Terminologies

### M-PESA

M-PESA is a mobile money transfer service in Kenya.

### Command IDs

Unique commands that specify the type of transaction. Examples include:

- **Salary Payment:** Sends money to registered/unregistered M-Pesa customers.
- **Business Payment:** Sends money to registered M-Pesa customers.
- **Promotion Payment:** Sends promotional payments with congratulatory messages.

### Short Code

A unique number for receiving customer payments. Examples include:

- **Pay Bill:** Collects money regularly.
- **Buy Goods:** For retail purchases.
- **Till Number:** Attached to a store.

### REST

A software architectural style for web services.

### APIs

Functions and procedures for creating applications that access features or data of a service.

### DOCS

Technical documentation for using and integrating with an API.

## Testing on Localhost

Use an HTTP tunneling client like Ngrok or LocalTunnel to make your local services accessible over the internet for testing.

## Going Live

After testing in the sandbox, you can go live. Prerequisites include:

- Having an M-PESA account (PayBill, Till Number, or B2C).
- Having access to the M-PESA Portal and having created an Admin or Business Manager.

Follow the steps on the "Go Live" page. If you don't have an admin, contact the M-PESA Business onboarding team at `m-pesabusiness@safaricom.co.ke`.

## Callback and IP Whitelisting

The API gateway communicates via callback URLs for payment notifications. You need to whitelist the following IP addresses to accept callbacks:

- 196.201.214.200
- 196.201.214.206
- 196.201.213.114
- 196.201.214.207
- 196.201.214.208
- 196.201.213.44
- 196.201.212.127
- 196.201.212.138
- 196.201.212.129
- 196.201.212.136
- 196.201.212.74
- 196.201.212.69

Whitelisting ensures only notifications from the Safaricom API Gateway are processed.

## M-Pesa API Certificates

M-Pesa public key certificates are available for download for both Sandbox and Production environments. These certificates are used to encrypt security credentials for APIs like B2C, B2B, Transaction Status Query, and Reversal.

**Note:** These certificates are not for accessing the M-PESA Organization portal. Learn more about portal certificates.

## How to Generate Your Security Credentials

M-Pesa Core authenticates transactions by decrypting security credentials. These credentials are generated by encrypting the base64-encoded initiator password with M-Pesa's public key (an X509 certificate).

### Algorithm for Generating Security Credentials

1. Write the unencrypted password into a byte array.
2. Encrypt the array using the M-Pesa public key certificate, specifically using the RSA algorithm and applying PKCS #1.5 padding (not OAEP).
3. Convert the resulting encrypted byte array into a string using base64 encoding.
4. The resulting base64-encoded string is the security credential.

**Note:** Ensure you use the correct public key certificate for the specific environment (Sandbox or Production).

## Creating an HTTP Server

M-Pesa APIs are asynchronous, with responses sent to a CallBackURL or ResultURL. If your server is unavailable, the API Gateway logs a 503 error and discards results.

To receive responses, you need to:

- Deploy an HTTP listener with POST methods.
- Use tools like Ngrok or LocalTunnel for local testing.

Sample JSON responses and HTTP listeners in Python, NodeJS, PHP, and Java are provided in the API documentation.

## SSL Certificates

Safaricom offers SSL Certificates for robust server authentication, data encryption, and protection against cyber threats. Learn more about SSL Certificates.





