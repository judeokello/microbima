# MicroBima API Environment Configuration
# Copy this file to .env and update with your actual values
#
# Note: This file documents all environment variables used by the API application.
# For local development, create a .env file (which is gitignored).
# In production/staging, set these as environment variables (e.g., via Fly.io secrets).

# ==============================================================================
# Database Configuration
# ==============================================================================

# PostgreSQL connection string
# Format: postgresql://[user]:[password]@[host]:[port]/[database]
# Required for: staging, production
# Optional for: development (defaults to localhost:5432/microbima_dev)
DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:54322/postgres

# Direct database connection URL (bypasses connection pooling)
# Used by Prisma for migrations and schema operations
# Typically same as DATABASE_URL but can be different if using connection pooling
DIRECT_URL=postgresql://postgres:postgres@127.0.0.1:54322/postgres

# ==============================================================================
# Supabase Configuration
# ==============================================================================

# Supabase project URL
# Required for authentication and Supabase services
# Local development: http://127.0.0.1:54321
# Staging/Production: https://your-project.supabase.co
SUPABASE_URL=http://127.0.0.1:54321

# Supabase anonymous key (public key)
# Used for client-side Supabase operations
# Local development: Uses default demo key
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0

# Supabase service role key (private key - keep secret!)
# Used for server-side admin operations (user creation, etc.)
# Required for bootstrap and root user creation
# Local development: Uses default demo key
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU

# ==============================================================================
# Bootstrap Configuration
# ==============================================================================

# Enable bootstrap endpoint for initial setup
# Set to 'true' to enable first admin user creation (use with caution!)
# This should be disabled in production after initial setup
# Note: Bootstrap routes are excluded from global API prefix
ENABLE_BOOTSTRAP=true

# ==============================================================================
# General Environment Configuration
# ==============================================================================

# Node.js environment
# Options: 'development' | 'staging' | 'production'
# Affects: logging levels, error handling, defaults, validation
NODE_ENV=development

# Server port
# Default: 3001 (if not set)
# Used by: Express server
PORT=3001

# API prefix for all routes
# Default: 'api' (if not set)
# Routes will be accessible at: /api/...
# Health check and bootstrap routes are excluded from prefix
# API_PREFIX=api

# ==============================================================================
# JWT Configuration
# ==============================================================================

# JWT secret key for signing tokens
# Required: yes (in staging/production)
# Default: 'dev-secret-key-change-in-production' (development only)
# Must be a strong, random string in production
JWT_SECRET=your_jwt_secret_key_here

# JWT token expiration time
# Default values by environment:
#   - production: '15m' (15 minutes)
#   - staging: '1h' (1 hour)
#   - development: '24h' (24 hours)
# Format: number + unit (s=seconds, m=minutes, h=hours, d=days)
JWT_EXPIRES_IN=24h

# ==============================================================================
# Sentry Configuration (Error Tracking)
# ==============================================================================

# Sentry DSN for error tracking
# Optional: If not set, Sentry is disabled
# Format: https://[key]@[organization].ingest.sentry.io/[project_id]
# Get this from: https://sentry.io/settings/[organization]/projects/[project]/keys/
SENTRY_DSN=YOUR_SENTRY_DSN

# Sentry environment name
# Default: Uses NODE_ENV value if not set
# Used for filtering errors by environment in Sentry dashboard
SENTRY_ENVIRONMENT=development

# Sentry traces sample rate (0.0 to 1.0)
# Default: 1.0 (100% of transactions traced)
# Lower values reduce performance overhead
# Format: decimal number (e.g., 1.0, 0.5, 0.1)
SENTRY_TRACES_SAMPLE_RATE=1.0

# Sentry profiles sample rate (0.0 to 1.0)
# Default: 1.0 (100% of transactions profiled)
# Used for performance profiling
# Format: decimal number (e.g., 1.0, 0.5, 0.1)
SENTRY_PROFILES_SAMPLE_RATE=1.0

# ==============================================================================
# Root User Configuration (Bootstrap)
# ==============================================================================

# Root user email address
# Required for: initial bootstrap/user creation
# Used by: bootstrap endpoint and seed scripts
# Only used when no users exist in database
ROOT_USER_EMAIL=tech@maishapoa.co.ke

# Root user password
# Required for: initial bootstrap/user creation
# Used by: bootstrap endpoint and seed scripts
# Must be a strong password in production
ROOT_USER_PASSWORD=your_secure_password_here

# Root user display name
# Optional: Defaults to 'Root admin' if not set
# Used as the display name for the root user
ROOT_USER_DISPLAY_NAME=M Admin

# ==============================================================================
# M-Pesa Daraja API Configuration
# ==============================================================================

# M-Pesa API Consumer Key
# Required: yes
# Get from: Safaricom Developer Portal (https://developer.safaricom.co.ke/)
# Used for: OAuth authentication with M-Pesa Daraja API
MPESA_CONSUMER_KEY=your_mpesa_consumer_key_here

# M-Pesa API Consumer Secret
# Required: yes
# Get from: Safaricom Developer Portal (https://developer.safaricom.co.ke/)
# Used for: OAuth authentication with M-Pesa Daraja API
MPESA_CONSUMER_SECRET=your_mpesa_consumer_secret_here

# M-Pesa Business Short Code
# Required: yes
# Format: 5-6 digit number (e.g., '174379' for sandbox, your business code for production)
# Used for: STK Push and IPN transactions
MPESA_BUSINESS_SHORT_CODE=174379

# M-Pesa Passkey
# Required: yes
# Get from: Safaricom Developer Portal or M-Pesa portal
# Used for: STK Push password generation
# Note: Newlines and whitespace are automatically stripped
MPESA_PASSKEY=your_mpesa_passkey_here

# M-Pesa Environment
# Required: yes
# Options: 'sandbox' | 'production'
# Default: 'sandbox' (if not set)
# Affects: API base URL, validation, error handling
MPESA_ENVIRONMENT=sandbox

# M-Pesa Base URL
# Optional: Defaults based on MPESA_ENVIRONMENT if not set
# Sandbox: https://sandbox.safaricom.co.ke/mpesa
# Production: https://api.safaricom.co.ke/mpesa
# Only override if using custom endpoints
# MPESA_BASE_URL=https://sandbox.safaricom.co.ke/mpesa

# ==============================================================================
# M-Pesa Callback URLs
# ==============================================================================

# STK Push Callback URL
# Required: yes
# Format: Must be HTTPS (HTTP not allowed)
# Used by: M-Pesa to send STK Push status callbacks
# Must be publicly accessible and registered in M-Pesa portal
# Local development: Use ngrok or similar tunnel service
# Example: https://your-domain.com/api/public/mpesa/stk-push/callback
MPESA_STK_PUSH_CALLBACK_URL=https://your-domain.com/api/public/mpesa/stk-push/callback

# IPN Confirmation URL
# Required: yes
# Format: Must be HTTPS (HTTP not allowed)
# Used by: M-Pesa to send Instant Payment Notification (IPN) callbacks
# Must be publicly accessible and registered in M-Pesa portal
# Local development: Use ngrok or similar tunnel service
# Example: https://your-domain.com/api/public/mpesa/confirmation
MPESA_IPN_CONFIRMATION_URL=https://your-domain.com/api/public/mpesa/confirmation

# ==============================================================================
# M-Pesa IP Whitelist Configuration
# ==============================================================================

# M-Pesa Allowed IP Ranges
# Optional for: development (all IPs allowed)
# Required for: production (must whitelist Safaricom IP ranges)
# Format: Comma-separated CIDR notation (e.g., '196.201.214.0/24,196.201.215.0/24')
# Used by: IpWhitelistGuard to validate callback requests
# Get Safaricom IP ranges from: Safaricom support or documentation
# Local development: Can use localhost IPs or leave empty (all IPs allowed in dev)
MPESA_ALLOWED_IP_RANGES=127.0.0.1/32,::1/128

# ==============================================================================
# M-Pesa STK Push Timeout Configuration (Optional)
# ==============================================================================

# STK Push Request Timeout (in minutes)
# Optional: Default is 5 minutes
# Used for: Determining when STK Push requests expire
# Format: Integer number (e.g., 5, 10)
# MPESA_STK_PUSH_TIMEOUT_MINUTES=5

# STK Push Expiration Check Interval (in minutes)
# Optional: Default is 2 minutes
# Used for: Periodic job that checks for expired STK Push requests
# Format: Integer number (e.g., 2, 5)
# MPESA_STK_PUSH_EXPIRATION_CHECK_INTERVAL_MINUTES=2

# ==============================================================================
# M-Pesa STK Push Runtime Enable/Disable (Optional)
# ==============================================================================

# Enable or disable M-Pesa STK Push initiation at runtime
# Optional: If not set or any value other than 'true' (case-insensitive), STK push is disabled
# Values: 'true', 'True', 'false', 'False' (case-insensitive); only 'true' enables STK push
# When disabled: POST /internal/mpesa/stk-push/initiate returns 503; GET /internal/config returns mpesaStkPushEnabled: false
# Local: set in .env; Staging/Production: set as Fly secret on the internal-api app (e.g. fly secrets set MPESA_STK_PUSH_ENABLED=true)
# MPESA_STK_PUSH_ENABLED=true

